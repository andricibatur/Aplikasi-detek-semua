<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Scanner Barcode Otomatis</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; text-align: center; }
    #reader { width: 100%; max-width: 500px; margin: auto; }
    #log { margin-top: 15px; padding: 10px; background: #fff; border: 1px solid #ccc; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto; }
    .log-entry { padding: 5px; border-bottom: 1px solid #ddd; }
  </style>
</head>
<body>
  <h2>Scanner Barcode Otomatis</h2>
  <div id="reader"></div>
  <div id="log"><strong>Hasil Scan:</strong></div>

  <!-- Suara bip -->
  <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script>
    const logContainer = document.getElementById('log');
    const beep = document.getElementById('beep');
    const scannedSet = new Set(); // opsional: hilangkan jika ingin duplikat boleh

    function onScanSuccess(decodedText, decodedResult) {
      // Jika ingin hindari duplikat, gunakan Set
      if (scannedSet.has(decodedText)) return;
      scannedSet.add(decodedText);

      // Suara bip
      beep.play().catch(e => console.log("Audio error:", e));

      // Getar
      if (navigator.vibrate) navigator.vibrate(300);

      // Tampilkan hasil ke log
      const entry = document.createElement("div");
      entry.className = "log-entry";
      entry.textContent = `ðŸ“¦ ${decodedText} (${new Date().toLocaleTimeString()})`;
      logContainer.appendChild(entry);
    }

    // Start scanning
    new Html5Qrcode("reader")
      .start(
        { facingMode: "environment" },
        {
          fps: 10,
          qrbox: 250,
          rememberLastUsedCamera: true
        },
        onScanSuccess
      )
      .catch(err => {
        logContainer.innerHTML = "Gagal membuka kamera: " + err;
        console.error(err);
      });
  </script>
</body>
</html>
